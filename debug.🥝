# For experimentation and fun.

/#
@brief A function to process a list in chunks.
@param input_list The input list.
@param chunk_size The size of the chunk to process.
@param callback A callback to process each chunk with.
@return List of results from each callback.
#/
fn process_chunkwise(input_list, chunk_size, callback)
  results = []
  chunk_count = math::ceil(input_list.size() / chunk_size.to_double()).to_int()
  
  repeat chunk_count as chunk do
    chunk_index = (chunk - 1) * chunk_size
    chunk_data = input_list[chunk_index:chunk_index + chunk_size]
    results.push(callback(chunk_data))
  end

  return results
end

start = time::ticks()

# Just stress testing the language a little.
process_chunkwise
(
  /# Generate a bunch of random hashes with two keys: 
     - id (an integer),
     - text (a random hex value). #/
  [1..1000000].map(with (n) do 
    { "id": n, 
      "text": math::random("abcdef0123456789", 5) } 
  end),
  # Do this in chunks of 200.
  200,
  # The callback in this case will just print the item.
  with (item) do
    println item
  end
)

println "finished in ${time::ticksms(time::ticks() - start) / 1000} seconds"
