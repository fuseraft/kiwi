# a script for debugging and experimentation (and fun!)

fn example()
  fn build_lambda()
    return (with (n) do
      return n
    end)
  end

  fn invoke(l: lambda, n: any): any
    return l(n)
  end

  arr = [
    build_lambda(),
    build_lambda(),
    build_lambda(),
    build_lambda()
  ]

  for l, i in arr do
    println invoke(l, 1 + i)
  end
end

# Load the shared library
ffi.load("mathlib", "/usr/lib/x86_64-linux-gnu/libgsl.so")

# Attach a function from the library
ffi::attach("mathlib", "add", "c_add", "int,int,int")

# Call the function
sum = ffi::invoke("add", [10, 20])
println(sum)  # Output: 30

# Unload the library when done
ffi::unload("mathlib")
