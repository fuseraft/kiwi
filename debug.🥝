# a script for debugging and experimentation (and fun!)

tasks = []

for i in [1..10] do
  tasks.push(fork (with () do
    random_sleep_ms = math::random(500, 1000)
    task::sleep(random_sleep_ms) # simulate work with randomized duration
    println "task with id ${i} is running..."

    return { "id": i, "sleep_ms": random_sleep_ms }
  end)())
end

println "This will print first."

while task::busy() do
  task::sleep(100) # avoid busy waiting
end

for task_id in tasks do
  task_result = task::result(task_id)
  println "task result is: ${task_result}"
end